<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

use App\Http\Requests;
use App\Http\Controllers\Controller;
use Auth;
use DB;
use yajra\Datatables\Datatables;
use URL;

class ReportsController extends Controller
{
    public function __construct() {
        ini_set('memory_limit', '256M');
        ini_set('max_execution_time', 300); //300 seconds = 5 minutes
    }

    //
    public function employee_report() {
        //if(!Auth::user()->can('employee_report'))
        //    abort(403);

        $page_title = 'Employees Report';
        $data = DB::table('V_EMP')->select(['FP_ID', 'EMP_ID', 'EMP_NAME', 'F_H_NAME', 'DOB','GENDER', 'CNIC', 'DOMICILE','JOB_STATUS','MOBILE_NO','RELIGION',
            'MAILING_ADDRESS','PERMENENT_ADDRESS','HOME_DISTRICT','CADRE_NAME','CURRENT_POST','CURRENT_BS','DATE_OF_APPOINTMENT',
             'SERVICE_TYPE','TYPE_OF_APPOINTMENT','THROUGH_ADVER',"ACR_TOTAL",
            "ACR_SUBMITTIED",
            "ACR_REMAINING",
            "ASSET_TOTAL",
            "ASSET_SUBMITTIED",
            "ASSET_REMAINING",
            "TOTAL_POSTING",
            "TOTAL_TRANSFER",
            "TOTAL_REWARD",
            "TOTAL_DEPENDENTS",
            "TOTAL_PANELTIES",
            "TOTAL_TRAINING",])
            ->get();

        return view('reports.employee_report_list', compact('page_title', 'data'));
    }

    public function employee_report_data(){
        $emp = DB::table('V_EMP')->select(['FP_ID', 'EMP_ID', 'EMP_NAME', 'F_H_NAME', 'DOB','GENDER', 'CNIC', 'DOMICILE','JOB_STATUS','MOBILE_NO','RELIGION',
            'MAILING_ADDRESS','PERMENENT_ADDRESS','HOME_DISTRICT','CADRE_NAME','CURRENT_POST','CURRENT_BS','DATE_OF_APPOINTMENT',
            'SERVICE_TYPE','TYPE_OF_APPOINTMENT','THROUGH_ADVER',"ACR_TOTAL",
            "ACR_SUBMITTIED",
            "ACR_REMAINING",
            "ASSET_TOTAL",
            "ASSET_SUBMITTIED",
            "ASSET_REMAINING",
            "TOTAL_POSTING",
            "TOTAL_TRANSFER",
            "TOTAL_REWARD",
            "TOTAL_DEPENDENTS",
            "TOTAL_PANELTIES",
            "TOTAL_TRAINING",]);

        return Datatables::of($emp)
            ->addColumn('action', function ($emp) {
                $profile_view = (Auth::user()->hasRole('admin')) ? '<a href="'.URL::to('/employee/profile').'/'.$emp->emp_id.'" class="btn btn-xs btn-default"><i class=" fa fa-picture-o"></i> Profile</a>' : '';
                return '<a href="'.URL::to('/employee/icp_chart').'/'.$emp->emp_id.'" class="btn btn-xs btn-primary"><i class="fa fa-file-text-o"></i>  ICP Chart</a>'.$profile_view;
            })
            /*->addColumn('profile_picture', function($emp) {
                return '<img src="'.URL::to('/storage/emp_pic').'/'.$emp->fp_id.'" class="img">';
            })*/
            ->editColumn('fp_id', function($emp) {
                if(file_exists('storage/emp_pic/'.$emp->fp_id.'.jpg'))
                    return '<img src="'.URL::to('/storage/emp_pic').'/'.$emp->fp_id.'.jpg" style="width:60px;" class="img-responsive">';
                else
                    return '<img src="'.URL::to('/storage/emp_pic').'/default.png" style="width:60px;" class="img-responsive">';
            })
            ->make();
    }

    public function training_foreign() {
        $page_title = 'Training Foreign';

        $data = DB::table('V_TRAINING_FOREIGN')
            ->select(
                [
                    "EMP_ID",
                    "EMP_NAME",
                    "F_H_NAME",
                    "DOB",
                    "GENDER",
                    "CNIC",
                    "RELIGION",
                    "HOME_DISTRICT",
                    "FP_ID",
                    "REF_FILE_NO",
                    "DESIGNATION",
                    "DESIG_BS",
                    "P_CHARGE_ID",
                    "CARRIER_ID",
                    "SANCTION_ID",
                    "BS",
                    "STATION_STATUS",
                    "POSTING_STATUS",
                    "JOINING_DATE",
                    "RELIEVING_DATE",
                    "ORDER_ID",
                    "REPORTING_OFF_ID",
                    "STRENGTH_NAME",
                    "REMARKS",
                    "CARRIER_STATUS",
                    "SECTION_ID",
                    "POST_NAME",
                    "ZONE_TITLE",
                    "REGION_NAME",
                    "PLACE_TITLE",
                    "PLACE_TYPE",
                    "WING_NAME",
                    "SECTION_NAME",
                    "WING_HEAD",
                    "TENURE_INFO",
                    "TENURE_YEAR"
                ])->get();

        return view('reports.training_foreign', compact('page_title', 'data'));
    }
    public function training_done() {
        $page_title = 'Training Done';

        $data = DB::table('V_TRAINING_DONE')
            ->get();

        return view('reports.training_done', compact('page_title', 'data'));
    }

    public function training_foreign_data() {
        ini_set('max_execution_time', 300);
        $data = DB::table('V_TRAINING_FOREIGN')
            ->select(
                [
                    "EMP_ID",
                    "EMP_NAME",
                    "F_H_NAME",
                    "DOB",
                    "GENDER",
                    "CNIC",
                    "RELIGION",
                    "HOME_DISTRICT",
                    "FP_ID",
                    "REF_FILE_NO",
                    "DESIGNATION",
                    "DESIG_BS",
                    "P_CHARGE_ID",
                    "CARRIER_ID",
                    "SANCTION_ID",
                    "BS",
                    "STATION_STATUS",
                    "POSTING_STATUS",
                    "JOINING_DATE",
                    "RELIEVING_DATE",
                    "ORDER_ID",
                    "REPORTING_OFF_ID",
                    "STRENGTH_NAME",
                    "REMARKS",
                    "CARRIER_STATUS",
                    "SECTION_ID",
                    "POST_NAME",
                    "ZONE_TITLE",
                    "REGION_NAME",
                    "PLACE_TITLE",
                    "PLACE_TYPE",
                    "WING_NAME",
                    "SECTION_NAME",
                    "WING_HEAD",
                    "TENURE_INFO",
                    "TENURE_YEAR"
                ]);

        return Datatables::of($data)
            /*->addColumn('action', function ($data) {
                $profile_view = (Auth::user()->hasRole('admin')) ? '<a href="'.URL::to('/employee/profile').'/'.$emp->emp_id.'" class="btn btn-xs btn-default"><i class=" fa fa-picture-o"></i> Profile</a>' : '';
                return '<a href="'.URL::to('/employee/icp_chart').'/'.$emp->emp_id.'" class="btn btn-xs btn-primary"><i class="fa fa-file-text-o"></i>  ICP Chart</a>'.$profile_view;
            })*/
            /*->addColumn('profile_picture', function($emp) {
                return '<img src="'.URL::to('/storage/emp_pic').'/'.$emp->fp_id.'" class="img">';
            })*/
           /* ->editColumn('fp_id', function($emp) {
                if(file_exists('storage/emp_pic/'.$emp->fp_id.'.jpg'))
                    return '<img src="'.URL::to('/storage/emp_pic').'/'.$emp->fp_id.'.jpg" style="width:60px;" class="img-responsive">';
                else
                    return '<img src="'.URL::to('/storage/emp_pic').'/default.png" style="width:60px;" class="img-responsive">';
            })*/
            ->make();
    }

    public function training_local() {
        //DB::setDateFormat('DD/MM/YY');
        $page_title = 'Training Local';

        $data = DB::table('V_TRAINING_LOCAL')
            ->select(
                [
                    "EMP_ID",
                    "EMP_NAME",
                    "F_H_NAME",
                    "DOB",
                    "GENDER",
                    "CNIC",
                    "RELIGION",
                    "HOME_DISTRICT",
                    "FP_ID",
                    "REF_FILE_NO",
                    "DESIGNATION",
                    "DESIG_BS",
                    "P_CHARGE_ID",
                    "CARRIER_ID",
                    "SANCTION_ID",
                    "BS",
                    "STATION_STATUS",
                    "POSTING_STATUS",
                    "JOINING_DATE",
                    "RELIEVING_DATE",
                    "ORDER_ID",
                    "REPORTING_OFF_ID",
                    "STRENGTH_NAME",
                    "REMARKS",
                    "CARRIER_STATUS",
                    "SECTION_ID",
                    "POST_NAME",
                    "ZONE_TITLE",
                    "REGION_NAME",
                    "PLACE_TITLE",
                    "PLACE_TYPE",
                    "WING_NAME",
                    "SECTION_NAME",
                    "WING_HEAD",
                    "TENURE_INFO",
                    "TENURE_YEAR"
                ])->get();

        return view('reports.training_local', compact('page_title', 'data'));
    }

    public function employee_rewards() {
        //DB::setDateFormat('DD/MM/YY');
        $page_title = 'Employee Rewards';

        $data = DB::table('V_REWARD_EMP')
            ->select(
                [
                    "EMP_ID",
                    "EMP_NAME",
                    "F_H_NAME",
                    "DOB",
                    "GENDER",
                    "CNIC",
                    "DOMICILE",
                    "RELIGION",
                    "HOME_DISTRICT",
                    "CURRENT_POST",
                    "CURRENT_BS",
                    "JOB_STATUS",
                    "KIND_OF_REWARD",
                    "PURPOSE",
                    "LETTER_DATE",
                    "APP_AUTH",
                    "LETTER_NO"
                ])->get();

        return view('reports.employee_reward', compact('page_title', 'data'));
    }

    public function posting_history() {
        //DB::setDateFormat('DD/MM/YY');
        //ini_set('max_execution_time', 300);
        $page_title = 'Posting History';

        $data = DB::table('V_POSTING_HISTORY')
            ->select(
                [
                    "EMP_ID",
                    "EMP_NAME",
                    "F_H_NAME",
                    "CURRENT_POST",
                    "CURRENT_BS",
                    "DOB",
                    "GENDER",
                    "CNIC",
                    "DOMICILE",
                    "JOB_STATUS",
                    "RELIGION",
                    "HOME_DISTRICT",
                    "STATION_STATUS",
                    "POSTING_STATUS",
                    "JOINING_DATE",
                    "RELIEVING_DATE",
                    "REMARKS",
                    /*"POST_NAME",
                    "PLACE_TYPE",
                    "PLACE_TITLE",
                    "REGION_NAME",
                    "ZONE_TITLE",
                    "WING_NAME",
                    "WING_HEAD",
                    "SECTION_NAME",
                    "CHARGE_TITLE",
                    "POSTING_TENURE",*/
                ])->get();

        return view('reports.posting_history', compact('page_title', 'data'));
    }

    public function emp_profile() {
        $page_title = 'Employee Profile';

        $data = DB::table('V_EMP_PROFILE')
            ->select(
                [
                    "EMP_ID",
                    "EMP_NAME",
                    "F_H_NAME",
                    "CURRENT_DESIGNATION",
                    "CURRENT_BS",
                    "JOB_STATUS",
                    "DOB",
                    "GENDER",
                    "CNIC",
                    "DOMICLE",
                    "HOME_DISTRICT",
                    "RELIGION",
                    "MARITAL_STATUS",
                    "REF_FILE_NO",
                    "FP_ID",
                    "SERVICE_TYPE",
                    "WORKING_POST",
                    "WORKING_BS",
                    "STATION_STATUS",
                    "POSTING_STATUS",
                    "JOINING_DATE",
                    "RELIEVING_DATE",
                    "POSTING_DATE",
                    "POSTING_TENURE",
                    "TRANSFER_DATE",
                    "TRANSFER_TENURE",
                    "ORDER_ID",
                    "REPORTING_OFFICER",
                    "REMARKS",
                    "ZONE_TITLE",
                    "REGION_NAME",
                    "PLACE_TITLE",
                    "PLACE_TYPE",
                    "PACKAGE_NAME",
                    "WING_NAME",
                    "SECTION_NAME",
                    "WING_HEAD",
                    "CHARGE_INFO",
                    "CARRIER_ID",
                    "SANCTION_ID",
                    "ACR_TOTAL",
                    "ACR_SUBMITTIED",
                    "ACR_REMAINING",
                    "ASSET_TOTAL",
                    "ASSET_SUBMITTIED",
                    "ASSET_REMAINING",
                    "TOTAL_CONTRACT_EXT",
                    "TOTAL_EXT_DURATION",
                    "TOTAL_REWARD",
                    "TOTAL_DEPENDENTS",
                    "TOTAL_PANELTIES",
                    "TOTAL_POSTING",
                    "TOTAL_TRANSFER",
                    "TOTAL_TRAINING",
                ])->get();

        return view('reports.employee_profile', compact('page_title', 'data'));
    }

    public function emp_profile_data() {
        ini_set('max_execution_time', 300);
        $data = DB::table('V_EMP_PROFILE')
            ->select(
                [
                    "EMP_ID",
					"EMP_NAME",
					"F_H_NAME",
					"CURRENT_DESIGNATION",
					"CURRENT_BS",
                    "JOB_STATUS",
					"DOB",
					"GENDER",
					"CNIC",
					"DOMICLE",
					"HOME_DISTRICT",
					"RELIGION",
					"MARITAL_STATUS",
					"DUAL_NATIONALITY",
					"HIGHEST_QUALIFICATION",
					"REF_FILE_NO",
					"OFF_PHONE_NO",
					"OFF_EXT_NO",
					"RES_PHONE_NO",
					"MOBILE_NO",
					"PERMENENT_ADDRESS",
					"FP_ID",
					"APPOINTMENT_POST",
					"APPOINTMENT_BS",
					"DATE_OF_APPOINTMENT",
					"TYPE_OF_APPOINTMENT",
					"APPOINTMENT_QUOTA",
					"SERVICE_TYPE",
					"THROUGH_ADVER",
					"TOTAL_CONTRACT_EXT",
					"TOTAL_EXT_DURATION",
					"WORKING_POST",
					"WORKING_BS",
					"STATION_STATUS",
					"POSTING_STATUS",
					"JOINING_DATE",
					"RELIEVING_DATE",
					"POSTING_DATE",
					"POSTING_TENURE",
					"TRANSFER_DATE",
					"TRANSFER_TENURE",
					"TOTAL_POSTING",
					"TOTAL_TRANSFER",
					"ORDER_ID",
					"REPORTING_OFF_ID",
					"REPORTING_OFFICER",
					"REMARKS",
					"CARRIER_STATUS",
					"SECTION_ID",
					"ZONE_TITLE",
					"REGION_NAME",
					"PLACE_TITLE",
					"PLACE_TYPE",
					"PACKAGE_ID",
					"PACKAGE_NAME",
					"WING_NAME",
					"SECTION_NAME",
					"WING_HEAD",
					"P_CHARGE_ID",
					"CHARGE_INFO",
					"CARRIER_ID",
					"SANCTION_ID",
					"ACR_TOTAL",
					"ACR_SUBMITTIED",
					"ACR_REMAINING",
					"ASSET_TOTAL",
					"ASSET_SUBMITTIED",
					"ASSET_REMAINING",
					"TOTAL_REWARD",
					"TOTAL_DEPENDENTS",
					"TOTAL_PANELTIES",
					"TOTAL_TRAINING",
                ]);

        return Datatables::of($data)
            /*->addColumn('action', function ($data) {
                $profile_view = (Auth::user()->hasRole('admin')) ? '<a href="'.URL::to('/employee/profile').'/'.$emp->emp_id.'" class="btn btn-xs btn-default"><i class=" fa fa-picture-o"></i> Profile</a>' : '';
                return '<a href="'.URL::to('/employee/icp_chart').'/'.$emp->emp_id.'" class="btn btn-xs btn-primary"><i class="fa fa-file-text-o"></i>  ICP Chart</a>'.$profile_view;
            })*/
            /*->addColumn('profile_picture', function($emp) {
                return '<img src="'.URL::to('/storage/emp_pic').'/'.$emp->fp_id.'" class="img">';
            })*/
           /* ->editColumn('fp_id', function($emp) {
                if(file_exists('storage/emp_pic/'.$emp->fp_id.'.jpg'))
                    return '<img src="'.URL::to('/storage/emp_pic').'/'.$emp->fp_id.'.jpg" style="width:60px;" class="img-responsive">';
                else
                    return '<img src="'.URL::to('/storage/emp_pic').'/default.png" style="width:60px;" class="img-responsive">';
            })*/
            ->make();
    }

    public function acr() {
        $page_title = 'ACR Report';

        $data = DB::table('V_ACR')
            ->select(
                [
                    "EMP_ID",
                    "EMP_NAME",
                    "F_H_NAME",
                    "DOB",
                    "GENDER",
                    "CNIC",
                    "DOMICILE",
                    "RELIGION",
                    "HOME_DISTRICT",
                    "CURRENT_POST",
                    "CURRENT_BS",
                    "ACR_ID",
                    "DATE_FROM",
                    "DATE_TO",
                    "RO_NAME",
                    "CO_NAME",
                    "ACR_EDOC",
                    "YEAR_ID",
                    "JOB_STATUS",
                    "ACR_STATUS",
                    "YEAR_TITLE"
                ])->get();

        return view('reports.acr', compact('page_title', 'data'));
    }

    public function assets() {
        $page_title = 'Assets Report';

        $data = DB::table('V_ASSETS')->get();
            /*->select(
                [
                    "EMP_ID",
                    "EMP_NAME",
                    "F_H_NAME",
                    "DOB",
                    "GENDER",
                    "CNIC",
                    "DOMICILE",
                    "RELIGION",
                    "HOME_DISTRICT",
                    "CURRENT_POST",
                    "CURRENT_BS",
                    "PLACE_OF_POSTING",
                    "DATE_OF_RECEIPT",
                    "ASSETS_STATUS",
                    "YEAR_TITLE"
                ])->get();*/

        return view('reports.assets', compact('page_title', 'data'));
    }

}
