@extends("base")

@section('sidebar')
@parent
    <h1>Community Message</h1>
@endsection

@section('content')

    @if(!empty(Session::get('success')))
        <div class="alert alert-success" role="alter">
            {{Session::get('success')}}
        </div>
    @endif

<div class="box  box-primary">
    <div class="box-header">
      <h3 class="box-title">Community Messages</h3>
      <a href="{{ URL::to('community_msg/create') }}" class="btn btn-primary btn-sm btn-success pull-right">New Message</a>
    </div><!-- /.box-header -->
    <div class="box-body">
          <table class="table table-bordered table-striped theDataTable" id="project_record_table">
            <thead  class="bg-gray">
              <tr>
                <th>#</th>
                <th>Employee Name</th>
                <th>Father Name</th>
                <th>Mobile</th>
                <th>Relation</th>
                <th>Message</th>
                <th>Date</th>
                <th class="col-xs-2">Action</th>
              </tr>
            </thead>
            <tbody>

                @foreach($data as $key => $row)
                <tr>
                  <td>{{ $key + 1 }}</td>
                  <td>{{$row->emp_name }}</td>
                  <td>{{$row->f_h_name }}</td>
                  <td>{{$row->mobile_no }}</td>
                  <td>{{$row->r_title }}</td>
                  <td>{{$row->title }}</td>
                  <td>{{($row->entry_date) ? date('d-M-Y', strtotime($row->entry_date)) : '' }}</td>

                  <td>
                      <a class="btn btn-xs pull-left" href="javascript:void(0);" title="Image Gallery" id="gallery_{{$row->community_id}}"><i class="fa fa-image"></i></a>
                    <a class="btn btn-xs pull-left" href="{{ URL::to('community_msg/') . '/' . $row->community_id }}" title="Show">
                      <i class="fa fa-eye"></i>
                    </a>

                    @if ( $row->emp_id == Auth::user()->emp_id)
                        <a class="btn btn-xs pull-left" href="{{ URL::to('community_msg/') . '/' . $row->community_id . '/edit' }}"  title="Edit">
                          <i class="fa fa-pencil"></i>
                        </a>

                          {!! Form::open(['url'=>'/community_msg/'.$row->community_id, 'class'=>'pull-left', 'id'=>'delete_form']) !!}
                          {!! Form::hidden('_method', 'DELETE') !!}
                          <button class="btn btn-xs">
                              <i class="fa fa-times text-danger"></i>
                          </button>
                          {!! Form::close() !!}
					@endif
                  </td>
                </tr>
                @endforeach

            </tbody>
           </table>
    </div><!-- /.box-body -->
</div><!-- /.box -->

    <link rel="stylesheet" href="{{url('public/plugins/fancybox/jquery.fancybox.css')}}">
    <script src="{{url('public/plugins/fancybox/jquery.fancybox.js')}}" type="text/javascript"></script>

<script>
    $(document).ready(function() {

        @foreach($data as $row)

        <?php $pictures = DB::table('TBL_COMMUNITY_PICTURE')->where('COMMUNITY_ID', '=', $row->community_id)->get(); ?>

       $("#gallery_{{ $row->community_id }}").click(function() {
                    $.fancybox([
                        @foreach($pictures as $picture)
                        '{{url($picture->community_edoc)}}',
                        @endforeach
                    ],
                    {
                        'titlePosition' 	: 'over',
                        'titleFormat'       : function(title, currentArray, currentIndex, currentOpts) {
                            return '<span id="fancybox-title-over">Image ' +  (currentIndex + 1) + ' / ' + currentArray.length + ' ' + title + '</span>';
                        }
                    });
                });
        @endforeach
    });
</script>

@stop
