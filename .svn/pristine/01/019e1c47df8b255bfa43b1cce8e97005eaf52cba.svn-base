

@extends("base")

     @section('sidebar')
     @parent
         <h1>Role</h1>
     @endsection

     @section('content')



          <div class="box box-primary">
              <div class="box-header">
                 <h4>Edit Role</h4>
              </div>
              <div class="box-body">
               {!! Form::open(array('url' => 'role/' . $role->id, 'method' => 'PUT', 'class' => 'form-horizontal')) !!}
                  <div class="col-sm-6">
                      <div class="row">
                          <div class="form-group">
                              <label class="col-sm-12 ">Name</label>
                              <div class="col-sm-12">
                                  {!! Form::text('name', $role->name, array('class' => 'form-control input-sm')) !!}
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="form-group">
                              <label class="col-sm-12">Display Name</label>
                              <div class="col-sm-12">
                                  {!! Form::text('display_name', $role->display_name, array('class' => 'form-control input-sm')) !!}
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="form-group">
                              <label class="col-sm-12">Description</label>
                              <div class="col-sm-12">
                                  {!! Form::textarea('description', $role->description, array('class' => 'form-control input-sm')) !!}
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="col-sm-6">
                      <table class="table table-responsive table-bordered table-striped">
                          <thead>
                          <tr>
                              <th>Permission</th>
                              <th>Mark</th>
                          </tr>
                          </thead>
                          <tbody>
                          @foreach($permissions as $permission)
                              <?php
                              $class = '';
                              $res = DB::table('permission_role')
                                      ->where('role_id', '=', $role->id)
                                      ->where('permission_id', '=', $permission->id)
                                      ->get();

                               ($res == null) ? $class = '' : $class = 'checked';
                              ?>
                              <tr>
                                  <td>{{ $permission->display_name  }}</td>
                                  <td><input type="checkbox" name="permissionsToAssign[]" value="{{ $permission->id  }}" {{ $class }}></td>
                              </tr>
							  <?php $submenus = App\Permission::where('parent', '=', $permission->id)->get(); ?>

								@if(!$submenus->isEmpty())									
									@foreach($submenus as $submenu)
                                        <?php
                                        $class = '';
                                        $res = DB::table('permission_role')
                                                ->where('role_id', '=', $role->id)
                                                ->where('permission_id', '=', $submenu->id)
                                                ->get();

                                        ($res == null) ? $class = '' : $class = 'checked';
                                        ?>
										<tr>
											<td style="padding-left:40px;">{{$submenu->display_name}}</td>
											<td><input type="checkbox" name="permissionsToAssign[]" value="{{ $submenu->id  }}" {{$class}}></td>
										</tr>
									@endforeach
								@endif

                          @endforeach
                          </tbody>
                      </table>

                  </div>
                  <div class="row">
                      <div class="col-sm-12">
                          <button type="submit" class="btn btn-primary pull-right">Save</button>
                      </div>
                  </div>

               {!! Form::close()!!}
              </div>
          </div>
     @stop
